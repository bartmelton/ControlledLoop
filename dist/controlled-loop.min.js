'use strict';(function(){var controlledLoop=function(data,controller,options){var loopData=data||[];var loopKeys=[];var loopOptions={increment:1,startAt:0,keys:[],reverse:false,apply:null,controller:function(v){return v;}};var paused=true;var values=[];var lastReturn={key:null,value:null};var done={next:false,previous:true};var reversed=false;var current=0;var last=0;var extOpt={};var counter=0;function extend(base,over){for(var x in over){base[x]=over[x];}};function args2array(base,args,offset){var off=offset||0;for(;off<args.length;off++){base.push(args[off]);}
return base;};var cloop={next:function(){return doDir.apply(cloop,args2array([1,"done"],arguments));},previous:function(){return doDir.apply(cloop,args2array([-1,"donep"],arguments));},repeat:function(){return process.apply(cloop,args2array([0],arguments));},run:function(count){if(count&&count>0){counter=Math.abs(count);}
cloop.pause(false);return cloop.next.apply(cloop,args2array([],arguments,1));},runBack:function(count){if(count&&count>0){counter=Math.abs(count);}
cloop.pause(false);return cloop.previous.apply(cloop,args2array([],arguments,1));},reverse:function(opts){var options={reset:false,clear:false,position:-1};if(opts){extend(options,opts);}
loopOptions.increment*=-1;reversed=!reversed;if(options.reset){cloop.reset(options.clear,options.position);}
else if(options.clear){cloop.clearValues();}
return cloop;},reset:function(clear,position){var start=(position!==null&&position!==undefined&&position>-1&&position<=last)?position:loopOptions.startAt;current=(reversed?last-start+(-1*loopOptions.increment):start-loopOptions.increment);if(clear){cloop.clearValues();}
done={next:cloop.isComplete(),previous:cloop.isComplete(true)};return cloop;},skip:function(steps,execute){if(reversed){steps=-1*steps;}
current+=steps;if(current>last){current=last;}
else if(current<0){current=0;}
return execute?process.apply(cloop,args2array([0],arguments,2)):cloop;},gotoKey:function(key,execute){var x;var found=false;for(x=0;x<last;x++){if(loopKeys[x]==key){current=x;found=true;break;}}
if(!found){return{value:undefined,key:undefined,done:done.next,donep:done.previous}}
return execute?process.apply(cloop,args2array([0],arguments,2)):cloop;},setOptions:function(opt,value){var o=(typeof opt=='object')?opt:{};var updateable=["increment","startAt","apply","controller"];if(typeof opt=='string'){o[opt]=value;}
updateable.forEach(function(v){if(o[v]!==undefined){loopOptions[v]=o[v];}});updateApply();return cloop;},isComplete:function(previous){var nxt=current+loopOptions.increment;if(previous){nxt=current-loopOptions.increment;}
return nxt<0||nxt>last;},pause:function(state){paused=(state===true||state===false)?state:!paused;return cloop;},getValues:function(asObject){var ret=values;if(asObject){ret={};loopKeys.forEach(function(v,k){ret[v]=values[k];});}
return ret;},getValue:function(key,asObject){var ret=null;loopKeys.forEach(function(v,k){if(v==key){ret=values[k];if(asObject){ret={};ret[v]=values[k];}
return false;}});return ret;},clearValues:function(){values.length=0;return cloop;},status:function(){return{position:current,end:last,done:done.next,donep:done.previous,increment:Math.abs(loopOptions.increment),values:values,keys:loopKeys,reversed:reversed,paused:paused,applied:loopOptions.apply};},getLastReturn:function(){return lastReturn;},defer:function(){var position=current+0;var returnObj={value:null,key:loopKeys[position],done:cloop.isComplete(),donep:cloop.isComplete(true)};return function(val){values[position]=val;returnObj.value=val;return returnObj;}}};function doDir(dir,doneType){var wasRunning=!paused;var ret=process.apply(cloop,args2array([dir],arguments,2))
if(ret[doneType]){counter=0;cloop.pause(true);}
else if(counter>0){counter--;if(counter==0){cloop.pause(true);}}
if(paused){return wasRunning?cloop:ret;}
return doDir.apply(cloop,arguments);}
function process(dir){var tmp;var nxt=current+(loopOptions.increment*dir);var params=null;if(nxt<0||nxt>last){return{value:undefined,key:undefined,done:(dir==1||(dir==0&&done.next)),donep:(dir==-1||(dir==0&&done.previous))}}
current=nxt;params=args2array([loopData[loopKeys[current]],loopKeys[current],cloop],arguments,1);tmp=loopOptions.controller.apply(loopOptions.apply,params);values[current]=tmp;done={next:cloop.isComplete(),previous:cloop.isComplete(true)};lastReturn={value:tmp,key:loopKeys[current],done:done.next,donep:done.previous};return lastReturn;};function updateApply(){if(!loopOptions.apply){loopOptions.apply=null;}
else if(loopOptions.apply===true){loopOptions.apply=loopData;}};if(controller instanceof Function){loopOptions.controller=controller;if(options!=null){extOpt=options;}}
else if(controller!=null){extOpt=controller;}
extend(loopOptions,extOpt);if(loopOptions.keys){loopKeys=loopOptions.keys}
if(loopKeys.length==0){loopKeys=Object.keys(loopData);}
delete loopOptions.keys;updateApply();last=loopKeys.length-1;loopOptions.increment=Math.abs(loopOptions.increment);loopOptions.startAt=Math.abs(loopOptions.startAt);if(loopOptions.reverse){cloop.reverse();}
delete loopOptions.reverse;cloop.reset();return cloop;};var isExtended=false;if(typeof define==="function"&&typeof define.amd=='object'&&define.amd){define({controlledLoop:controlledLoop});isExtended=true;}
else if(typeof exports!=="undefined"){exports.controlledLoop=controlledLoop;isExtended=true;}
if(typeof _=="function"&&typeof _.mixin=="function"){_.mixin({'controlledLoop':controlledLoop});isExtended=true;}
if(!isExtended){if(typeof window!=="undefined"){window.controlledLoop=controlledLoop;}
else if(typeof global!=="undefined"){global.controlledLoop=controlledLoop;}
else{this.controlledLoop=controlledLoop}}})();