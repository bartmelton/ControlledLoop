'use strict';(function(){var controlledLoop=function(data,controller,options){var loopData=data||[];var loopKeys=[];var loopOptions={increment:1,startAt:0,keys:[],reverse:false,apply:false,target:null,controller:function(v){return v;}};var paused=true;var values=[];var lastReturn={key:null,value:null};var done={next:false,previous:true};var reversed=false;var current=0;var last=0;var extOpt={};var counter=0;var cloop={next:function(params){return doDir(1,"done",params);},previous:function(params){return doDir(-1,"donep",params);},repeat:function(params){return process(0,params);},run:function(params,count){if(count){counter=Math.abs(count);}
return cloop.pause(false).next(params);},runBack:function(params,count){if(count){counter=Math.abs(count);}
return cloop.pause(false).previous(params);},reverse:function(reset,position){loopOptions.increment*=-1;reversed=!reversed;if(reset){cloop.reset(position);}
return cloop;},reset:function(position){var start=(position!==null&&position!==undefined)?position:loopOptions.startAt;current=(reversed?last-start+(-1*loopOptions.increment):start-loopOptions.increment);done={next:cloop.isComplete(),previous:cloop.isComplete(true)};return cloop;},skip:function(steps,execute,params){if(reversed){steps=-1*steps;}
current+=steps;if(current>last){current=last;}
else if(current<0){current=0;}
return execute?process(0,params):cloop;},gotoKey:function(key,execute,params){var x;var found=false;for(x=0;x<last;x++){if(loopKeys[x]==key){current=x;found=true;break;}}
if(!found){return{value:undefined,key:undefined,done:done.next,donep:done.previous}}
return execute?process(0,params):cloop;},setOptions:function(opt,value){var o=(typeof opt=='object')?opt:{};var updateable=["increment","startAt","apply","target","controller"];if(typeof opt=='string'){o[opt]=value;}
updateable.forEach(function(v){if(o[v]!==undefined){loopOptions[v]=o[v];}});updateApply();return cloop;},isComplete:function(previous){var nxt=current+loopOptions.increment;if(previous){nxt=current-loopOptions.increment;}
return nxt<0||nxt>last;},pause:function(state){paused=(state!==null&&state!==undefined)?state:!paused;return cloop;},getValues:function(asObject){var ret=values;if(asObject){ret={};loopKeys.forEach(function(v,k){ret[v]=values[k];});}
return ret;},status:function(){return{position:current,end:last,done:done.next,donep:done.previous,increment:Math.abs(loopOptions.increment),values:values,keys:loopKeys,reversed:reversed,paused:paused,applied:loopOptions.apply,target:loopOptions.target};},getLastReturn:function(){return lastReturn;}};function doDir(dir,doneType,params){var wasRunning=!paused;var ret=process(dir,params);if(ret[doneType]){counter=0;cloop.pause(true);}
else if(counter>0){counter--;if(counter==0){cloop.pause(true);}}
if(paused){return wasRunning?cloop:ret;}
return doDir(dir,doneType,params);}
function process(dir,params){var tmp;var nxt=current+(loopOptions.increment*dir);if(nxt<0||nxt>last){return{value:undefined,key:undefined,done:(dir==1||(dir==0&&done.next)),donep:(dir==-1||(dir==0&&done.previous))}}
current=nxt;if(loopOptions.apply){tmp=loopOptions.controller.apply(loopOptions.target,[loopData[loopKeys[current]],loopKeys[current],params,cloop]);}
else{tmp=loopOptions.controller(loopData[loopKeys[current]],loopKeys[current],params,cloop);}
values[current]=tmp;done={next:cloop.isComplete(),previous:cloop.isComplete(true)};lastReturn={value:tmp,key:loopKeys[current],done:done.next,donep:done.previous};return lastReturn;};function updateApply(){if(loopOptions.apply&&(loopOptions.target==null||loopOptions.target===true)){loopOptions.target=loopData;}};if(controller instanceof Function){loopOptions.controller=controller;if(options!=null){extOpt=options;}}
else if(controller!=null){extOpt=controller;}
for(var x in extOpt){loopOptions[x]=extOpt[x];}
if(loopOptions.keys){loopKeys=loopOptions.keys}
if(loopKeys.length==0){loopKeys=Object.keys(loopData);}
delete loopOptions.keys;updateApply();last=loopKeys.length-1;loopOptions.increment=Math.abs(loopOptions.increment);loopOptions.startAt=Math.abs(loopOptions.startAt);if(loopOptions.reverse){cloop.reverse();}
delete loopOptions.reverse;cloop.reset();return cloop;};var isExtended=false;if(typeof define==="function"&&typeof define.amd=='object'&&define.amd){define({controlledLoop:controlledLoop});isExtended=true;}
else if(typeof exports!=="undefined"){exports.controlledLoop=controlledLoop;isExtended=true;}
if(typeof _=="function"&&typeof _.mixin=="function"){_.mixin({'controlledLoop':controlledLoop});isExtended=true;}
if(!isExtended){if(typeof window!=="undefined"){window.controlledLoop=controlledLoop;}
else if(typeof global!=="undefined"){global.controlledLoop=controlledLoop;}
else{this.controlledLoop=controlledLoop}}})();